## Sophos Firewall Lab 08: DMZ Setup

Hi there,

This is our final Sophos lab of the series. üòî 
We will carve out a true DMZ segment, place a web server inside it, and allow **external guests** to reach that server **without ever touching the LAN**, while **internal users** can still browse the same host.  
The payoff: a textbook **defence-in-depth** layout you can drop into any production network.

**Why a DMZ matters**  
A Demilitarized Zone sits **between** internal and external firewalls (or interfaces) and hosts services that must be reachable from the Internet that is web servers, mail gateways, VPN terminators etc. If any of these public facing boxes is compromised, the attacker is still **one more firewall hop** away from payroll data, Active Directory, and user PCs. In short, the DMZ is the **sacrificial lamb** that saves the crown jewels.

Let‚Äôs build it and test this.

---

![topology](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/01.Topology.PNG)

### Lab Setup (unchanged)
- PortA: LAN 10.1.1.0/24  
- PortB: WAN 192.168.10.0/24  
- PortC: DMZ 172.16.0.0/24 *(now active)*  
- Web-Server VM: 172.16.0.100 on PortC  
- External test PC: RemotePC on 192.168.10.0/24  
- Internal test PC: PC1 on 10.1.1.0/24  

**Note**: In production the ‚ÄúWAN‚Äù IP would be your **real public address**; we use the RFC-1918 range 192.168.10.200 here for lab convenience.

---

## Step 1 ‚Äì Create the DMZ Host Object

**Hosts and Services &gt; IP Host &gt; Add**  
- **Name**: `Web-Server`  
- **IP Address**: 172.16.0.100  
- **Type**: IPv4

Save.

![New IP host dialog with 172.16.0.100](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/02.Web-Server.png)


**Why define the host explicitly?**  
Using an object instead of typing the raw IP keeps NAT rules, firewall rules, and logs **human-readable**. If the server ever moves to 172.16.0.101 you change **one** object, not a dozen rules.

---

## Step 2 ‚Äì Build the External DNAT Rule with the Wizard

**Rules and Policies &gt; NAT Rules &gt; Server Access Assistant (DNAT)**

![DNAT wizard welcome page](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/04.DNAT%20assistance.png) 

Choose **‚ÄúInternal server IP address‚Äù**, select the `Web-Server` object we just created, click **Next**.

![Internal IP address](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/05.Internal%20IP.png)


Select **Public IP address**: 192.168.10.200 (drop-down lists PortB address), click **Next**.

![Public IP selection page](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/06.Public%20WAN.png)


On **Services** add **HTTP** and **HTTPS** only, click **Next**.

![HTTP/HTTPS checked](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/07.Services.png) 


Under **External sources** choose **Any**, click **Next**, review the summary, click **Finish**.

![Final review page](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/08.External.png)


![review](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/09.Review.png)


The wizard creates **two objects** for you:
1. A **DNAT rule** that maps `192.168.10.200:80/443` ‚Üí `172.16.0.100:80/443`  
2. A **firewall rule** that allows **WAN-to-DMZ** traffic for those services

![New NAT rule listed](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/10.NAT%20rules%20created.png)


![New firewall rule listed](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/11.Firewall%20Rule%20created.png)


Any packet arriving on PortB (WAN) destined for TCP 80 or 443 on 192.168.10.200 will be **destination-translated** to 172.16.0.100 and **allowed** into the DMZ. The source address remains the original public IP, so the web server logs show real client addresses‚Äîhandy for analytics and forensics.

---

## Step 3 ‚Äì Test from the Outside World

Log on to **RemotePC** (or any machine on the 192.168.10.0/24 ‚ÄúInternet‚Äù segment), open a browser, and browse to:http://192.168.10.200/


You should see the **web-server page** immediately.

![RemotePC browser showing web page](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/12.DMZ%20works!.png)  


**External test passed** Internet users can reach the web server **without** being able to ping, RDP, or browse anything on the 10.1.1.0 LAN.

---

## Step 4 ‚Äì Create the Internal LAN-to-DMZ Rule

Back on PC1 (10.1.1.0/24) try browsing to `http://172.16.0.100`  it will **fail** because no rule allows LAN ‚Üí DMZ yet.

**Rules and Policies > Add Firewall Rule**

- **Name**: `LAN-to-DMZ`  
- **Action**: **Accept**  
- **Log traffic**: **Yes** (always log new zones)  
- **Position**: move to **top** (above more general rules)

![Add firewall rule](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/13.Adding%20new%20firewall%20rule.png)


Under **Source**:
- **Zone**: LAN  
- **Networks/Devices**: **NET Users** (the group we defined in Lab 01)

![Source section ](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/14.New%20Rule%201.png)


Under **Destination**:
- **Zone**: DMZ  
- **Networks/Devices**: **Web-Server** (172.16.0.100)  
- **Services**: HTTP, HTTPS

![Destination section with DMZ and Web-Server selected](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/15.New%20Rule%202.png) 


Save and push the rule to the top of the list.

**Why place the rule at the top?**  
Sophos processes rules **top-down, first-match**. If a broader ‚ÄúLAN-to-ANY‚Äù rule sits above ours, the DMZ specific rule would never be evaluated, and you would lose the ability to apply **different security profiles** (IPS, QoS, quotas) to DMZ traffic later.

---

## Step 5 ‚Äì Test from the Inside Network

On **PC1** open a browser and browse to:http://172.16.0.100

The web-server page loads instantly.

![PC1 browser](https://github.com/RouteSeeker/Sophos/blob/main/assets/screenshots/09.DMZ%20Setup/16.DMZ%20works%20from%20internal%20LAN.png)  


**Internal test passed**  staff can reach the DMZ host **without** needing to hair-pin through the external IP and **without** any route that would let the web server initiate connections back into the LAN.

---

## Summary

In this final lab we:

- Created a **DMZ IP host object** (172.16.0.100) to keep rules readable.  
- Used the **Server Access Assistant (DNAT)** wizard to build an **external-facing NAT rule** and its companion firewall rule in one click.  
- Proved that **external users** can reach the web server via the firewall‚Äôs public IP while **LAN users** can reach the same server via its private DMZ IP‚Äîboth paths fully logged and policy controlled.  
- Placed the **LAN-to-DMZ rule at the top** to guarantee correct evaluation order and to leave room for future granular policies.

This concludes the Sophos firewall series. We now have a working foundation: rules, NAT, DHCP, DNS, VPN, certificates, SSL inspection, and DMZ‚Äîall documented and reproducible. Keep the lab running, break it, fix it, and build on it.  

**Never stop learning!**
